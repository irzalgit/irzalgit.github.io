<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Math Premium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="p-4">

  <!-- Halaman Login & Beranda -->
  <div id="halamanUtama">
    <h1 class="text-xl font-bold mb-2">Portal Matematika</h1>
    <p id="userStatus" class="mb-2 text-blue-600"></p>
    <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded mb-2">Login Google</button>
    <button id="btnPremium" class="hidden bg-purple-600 text-white px-4 py-2 rounded mb-2">ğŸ“ Akses Soal Premium</button>
    <button id="logoutBtn" onclick="logout()" class="hidden text-red-500 underline mb-4">Logout</button>
  </div>

  <!-- Halaman Soal Premium -->
  <div id="halamanPremium" class="hidden">
    <h2 class="text-lg font-bold mb-2">ğŸ“˜ Soal Premium</h2>
    <div id="daftarSoal" class="space-y-4 mb-4"></div>
    <button onclick="kembali()" class="bg-gray-300 px-4 py-2 rounded">â¬…ï¸ Kembali</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCu4GQa-EOaPhpQP_y_QcsJxs05adQU2-M",
      authDomain: "math314-app.firebaseapp.com",
      databaseURL: "https://math314-app-default-rtdb.firebaseio.com",
      projectId: "math314-app",
      storageBucket: "math314-app.appspot.com",
      messagingSenderId: "9019551034",
      appId: "1:9019551034:web:de0c5e2b8b20c18ca0b403"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();

    // Event Login
    document.getElementById("loginBtn").onclick = () => {
      auth.signInWithPopup(provider).then(result => updateUI(result.user));
    };

    function logout() {
      auth.signOut().then(() => location.reload());
    }

    function kembali() {
      document.getElementById("halamanPremium").classList.add("hidden");
      document.getElementById("halamanUtama").classList.remove("hidden");
    }

    function updateUI(user) {
      document.getElementById("userStatus").innerText = `Login sebagai ${user.displayName}`;
      document.getElementById("loginBtn").classList.add("hidden");
      document.getElementById("logoutBtn").classList.remove("hidden");

      const uid = user.uid;
      db.ref("data_siswa/" + uid).once("value").then(snapshot => {
        const data = snapshot.val();
        if (data && data.siap_bayar) {
          const btn = document.getElementById("btnPremium");
          btn.classList.remove("hidden");
          btn.onclick = () => {
            document.getElementById("halamanUtama").classList.add("hidden");
            document.getElementById("halamanPremium").classList.remove("hidden");
            loadSoalPremium();
          };
        }
      });
    }

    function loadSoalPremium() {
      const container = document.getElementById("daftarSoal");
      container.innerHTML = "<p>ğŸ”„ Memuat soal...</p>";

      db.ref("/soal").once("value").then(snapshot => {
        const data = snapshot.val();
        container.innerHTML = "";

        for (let key in data) {
          const soal = data[key];
          const div = document.createElement("div");
          div.className = "p-4 border rounded bg-white shadow";
          div.innerHTML = `
            <p class="font-semibold">${soal.pertanyaan}</p>
            <ul class="list-disc pl-5 mt-2 space-y-1">
              ${soal.pilihan.map(p => `<li>${p.teks}</li>`).join("")}
            </ul>
          `;
          container.appendChild(div);
        }
      });
    }

    // Auto login check
    auth.onAuthStateChanged(user => {
      if (user) updateUI(user);
    });
  </script>
</body>
</html>