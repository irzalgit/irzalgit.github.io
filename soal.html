<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Soal Gratis dengan Dropdown</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tambahkan MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-2xl font-bold mb-6 text-center">Portal Matematika</h1>

    <!-- Dropdown kategori -->
    <div class="mb-6 text-center">
      <label for="kategoriSelect" class="mr-2 font-semibold">Pilih Kategori:</label>
      <select id="kategoriSelect" class="border px-3 py-2 rounded-lg">
        <option value="">-- Pilih Kategori --</option>
      </select>
    </div>

    <div id="quiz-container"></div>

    <div class="mt-6 text-center">
      <button id="submitBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg">
        Periksa Jawaban
      </button>
    </div>

    <div id="result" class="mt-4 text-lg font-semibold text-center"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCu4GQa-EOaPhpQP_y_QcsJxs05adQU2-M",
      authDomain: "math314-app.firebaseapp.com",
      databaseURL: "https://math314-app-default-rtdb.firebaseio.com",
      projectId: "math314-app",
      storageBucket: "math314-app.appspot.com",
      messagingSenderId: "9019551034",
      appId: "1:9019551034:web:de0c5e2b8b20c18ca0b403",
      measurementId: "G-VWYDTY9LF6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const quizContainer = document.getElementById("quiz-container");
    const submitBtn = document.getElementById("submitBtn");
    const resultDiv = document.getElementById("result");
    const kategoriSelect = document.getElementById("kategoriSelect");

    let soalData = {};

    // Ambil data soal gratis
    const soalRef = ref(db, "soal_gratis");
    onValue(soalRef, (snapshot) => {
      soalData = snapshot.val() || {};
      isiDropdown(soalData);
    });

    // Isi dropdown kategori
    function isiDropdown(data) {
      kategoriSelect.innerHTML = `<option value="">-- Pilih Kategori --</option>`;
      Object.keys(data).forEach((kategori) => {
        const opt = document.createElement("option");
        opt.value = kategori;
        opt.textContent = kategori.toUpperCase();
        kategoriSelect.appendChild(opt);
      });
    }

    // Render soal berdasarkan kategori terpilih
    function renderQuiz(kategori) {
      quizContainer.innerHTML = "";
      resultDiv.innerHTML = "";

      if (!kategori || !soalData[kategori]) return;

      Object.keys(soalData[kategori]).forEach((key, index) => {
        const soal = soalData[kategori][key];
        const div = document.createElement("div");
        div.className = "mb-6 p-4 border rounded-lg";

        let html = `<p class="font-semibold mb-2">${index + 1}. ${soal.pertanyaan}</p>`;

        soal.pilihan.forEach((pil, i) => {
          html += `
            <label class="block cursor-pointer">
              <input type="checkbox" 
                     name="soal-${kategori}-${key}" 
                     value="${i}" 
                     class="mr-2">
              ${pil.teks}
            </label>
          `;
        });

        div.innerHTML = html;
        quizContainer.appendChild(div);
      });

      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    }

    // Event ganti kategori
    kategoriSelect.addEventListener("change", (e) => {
      renderQuiz(e.target.value);
      submitBtn.disabled = false;
    });

    // Event submit
    submitBtn.addEventListener("click", () => {
      let score = 0;
      let totalBenar = 0;
      const kategori = kategoriSelect.value;

      if (!kategori || !soalData[kategori]) return;

      Object.keys(soalData[kategori]).forEach((key) => {
        const soal = soalData[kategori][key];
        const checkboxes = document.querySelectorAll(`input[name="soal-${kategori}-${key}"]`);
        
        soal.pilihan.forEach((pil, i) => {
          const checkbox = checkboxes[i];

          if (pil.benar) totalBenar++;

          if (pil.benar && checkbox.checked) {
            score++;
            checkbox.parentElement.classList.add("text-green-600", "font-semibold");
          }

          if (!pil.benar && checkbox.checked) {
            checkbox.parentElement.classList.add("text-red-600", "line-through");
          }

          if (pil.benar) {
            checkbox.parentElement.classList.add("bg-green-100");
          }
        });
      });

      resultDiv.innerText = `Skor Anda: ${score} dari ${totalBenar}`;
      submitBtn.disabled = true;

      if (window.MathJax) {
        MathJax.typesetPromise();
      }
    });
  </script>
</body>
</html>